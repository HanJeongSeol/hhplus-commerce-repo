## e-커머스 프로젝트 사용자 시나리오

---
# 기능별 사용자 시나리오 분석

## 1. 포인트 관리 기능

### 1.1 포인트 충전
- **기본 시나리오**
    - 사용자가 포인트 충전 요청 시 시스템은 사용자 유효성을 검증
    - 유효한 사용자의 경우 충전 금액의 유효성을 검증
    - 검증 완료 후 트랜잭션을 시작하여 포인트 잔액을 업데이트
    - 충전 완료 후 결과를 사용자에게 반환

- **예외 시나리오**
    - 유효하지 않은 사용자
        - 시스템은 "유효하지 않은 사용자" 메시지 반환
    - 유효하지 않은 충전 금액
        - 0 이하의 금액 충전 시도 시 "유효하지 않은 충전 금액" 메시지 반환

### 1.2 포인트 조회
- **기본 시나리오**
    - 사용자가 잔액 조회 요청 시 시스템은 사용자 유효성을 검증
    - 유효한 사용자의 경우 현재 포인트 잔액을 조회하여 반환

- **예외 시나리오**
    - 유효하지 않은 사용자
        - 시스템은 "유효하지 않은 사용자" 메시지 반환

### 1.3 동시성 제어
- **동시 요청 시나리오**
    - 동일 사용자의 충전과 조회가 동시에 요청될 경우
    - 시스템은 비관적 락을 통해 충전 작업 완료 후 조회가 실행되도록 보장

## 2. 상품 관리 기능

### 2.1 상품 목록 조회
- **기본 시나리오**
    - 사용자가 상품 목록 조회 요청 시 전체 상품 정보 반환
    - 각 상품의 식별자, 이름, 가격, 재고 수량 포함
    - 재고가 0인 상품은 품절 상태로 표시

### 2.2 상품 상세 조회
- **기본 시나리오**
    - 사용자가 특정 상품 식별자로 조회 요청 시 해당 상품의 상세 정보 반환
    - 상품의 현재 재고 상태를 정확히 반영

- **예외 시나리오**
    - 존재하지 않는 상품
        - "상품을 찾을 수 없습니다" 메시지와 404 상태 코드 반환
    - 품절 상품
        - 상품 정보와 함께 품절 상태 명시하여 반환

### 2.3 동시성 제어
- **재고 변동 시나리오**
    - 상품 조회와 재고 변경이 동시에 발생하는 경우
    - 비관적 락을 통해 재고 변경 작업 완료 후 최신 재고 상태 조회 보장

## 3. 쿠폰 관리 기능

### 3.1 쿠폰 발급
- **기본 시나리오**
    - 사용자가 쿠폰 발급 요청 시 발급 이력 확인
    - 발급 이력이 없고 재고가 있는 경우 쿠폰 발급
    - 발급 내역을 저장하고 성공 메시지 반환

- **예외 시나리오**
    - 이미 발급받은 경우
        - "이미 쿠폰이 발급되었습니다" 메시지 반환
    - 재고 소진된 경우
        - "재고가 없습니다" 메시지 반환

### 3.2 쿠폰 조회
- **기본 시나리오**
    - 사용자가 보유 쿠폰 조회 요청 시 발급 이력 확인
    - 보유한 쿠폰 목록 반환

- **예외 시나리오**
    - 발급 이력 없음
        - "발급 이력이 없습니다" 메시지 반환

### 3.3 동시성 제어
- **선착순 발급 시나리오**
    - 다수 사용자가 동시에 쿠폰 발급 요청하는 경우
    - 비관적 락을 통해 정확한 재고 관리 및 선착순 발급 보장
    - 재고 소진 시 후순위 요청에 대해 재고 부족 메시지 반환

## 4. 주문/결제 기능

### 4.1 주문 처리
- **기본 시나리오**
    - 사용자가 상품 식별자, 수량, 쿠폰 식별자와 함께 주문 요청
    - 시스템은 상품 재고, 쿠폰 유효성 검증
    - 검증 완료 시 주문 상세 정보 생성 및 반환

- **예외 시나리오**
    - 재고 부족
        - "재고가 부족합니다" 메시지 반환
    - 유효하지 않은 쿠폰
        - "사용 불가능한 쿠폰입니다" 메시지 반환

### 4.2 결제 처리
- **기본 시나리오**
    - 사용자가 주문 식별자와 함께 결제 요청
    - 시스템은 포인트 잔액 확인 후 결제 처리
    - 결제 완료 시 주문 정보를 데이터 플랫폼으로 전송

- **예외 시나리오**
    - 잔액 부족
        - "포인트를 충전해주세요" 메시지 반환

### 4.3 동시성 제어
- **동시 결제 시나리오**
    - 동일 상품에 대한 다수의 결제 요청 발생 시 비관적 락을 통해 재고 관리 정확성 보장
    - 포인트 차감 시 동시성 제어로 잔액 정확성 보장

## 5. 인기 상품 관리 기능

### 5.1 배치 처리
- **기본 시나리오**
    - 매일 자정 배치 스케쥴러 실행
    - 최근 3일간의 판매 데이터 집계
    - 상위 5개 상품 정보 배치 테이블 갱신

### 5.2 조회 처리
- **기본 시나리오**
    - 사용자가 인기 상품 목록 요청
    - 배치 처리된 상위 5개 상품 정보 반환

- **예외 시나리오**
    - 집계 데이터 부재
        - "현재 인기 상품 정보가 없습니다" 메시지 반환
